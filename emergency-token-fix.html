<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emergency Token Fix</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(0, 0, 0, 0.3);
            padding: 30px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }
        
        h1 {
            text-align: center;
            color: #4ecdc4;
            margin-bottom: 30px;
        }
        
        .button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 20px 0;
            justify-content: center;
        }
        
        button {
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }
        
        .danger {
            background: linear-gradient(45deg, #ff6b6b, #ee5a52) !important;
        }
        
        .success {
            background: linear-gradient(45deg, #51cf66, #40c057) !important;
        }
        
        .log {
            background: rgba(0, 0, 0, 0.5);
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .info {
            background: rgba(33, 150, 243, 0.2);
            border-left: 4px solid #2196f3;
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
        }
        
        .warning {
            background: rgba(255, 193, 7, 0.2);
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
        }
        
        .success-box {
            background: rgba(76, 175, 80, 0.2);
            border-left: 4px solid #4caf50;
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Emergency Token Fix</h1>
        
        <div class="info">
            <strong>üéØ Purpose:</strong> This tool fixes the persistent issue where player tokens appear as colored circles instead of proper images. Use this when you see the message "[renderTokens] fallback circle - using assigned color" in the console.
        </div>
        
        <div class="warning">
            <strong>‚ö†Ô∏è When to Use:</strong> 
            <ul>
                <li>Tokens are showing as circles instead of images</li>
                <li>Console shows "fallback circle" messages</li>
                <li>Player tokens are not loading properly in multiplayer games</li>
            </ul>
        </div>
        
        <div class="button-group">
            <button onclick="validateTokens()" class="success">Validate Tokens</button>
            <button onclick="forceLoadTokens()">Force Load Tokens</button>
            <button onclick="autoFixTokens()" class="danger">Auto-Fix All Issues</button>
        </div>
        
        <div class="button-group">
            <button onclick="startMonitoring()" class="success">Start Monitoring</button>
            <button onclick="stopMonitoring()" class="danger">Stop Monitoring</button>
            <button onclick="clearLog()">Clear Log</button>
        </div>
        
        <div id="log" class="log">
            <div style="color: #4ecdc4;">[Ready] Emergency token fix loaded. Click a button to begin.</div>
        </div>
        
        <div class="success-box">
            <strong>‚úÖ Expected Results:</strong>
            <ul>
                <li>All player tokens should display as proper images (t1.png, t2.png, etc.)</li>
                <li>No more "fallback circle" messages in console</li>
                <li>Tokens should be consistent across all multiplayer clients</li>
                <li>Images should load automatically when players join</li>
            </ul>
        </div>
    </div>

    <!-- Load the emergency fix -->
    <script src="fix-token-rendering-issue.js"></script>
    
    <script>
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#ff6b6b' : 
                         type === 'success' ? '#51cf66' : 
                         type === 'warning' ? '#ffc107' : '#4ecdc4';
            
            logDiv.innerHTML += `<div style="color: ${color};">[${timestamp}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        function clearLog() {
            document.getElementById('log').innerHTML = '<div style="color: #4ecdc4;">[Cleared] Log cleared.</div>';
        }
        
        async function validateTokens() {
            log('üîç Validating player tokens...', 'info');
            
            try {
                const isValid = window.validatePlayerTokens();
                if (isValid) {
                    log('‚úÖ All player tokens are valid!', 'success');
                } else {
                    log('‚ö†Ô∏è Some player tokens have issues - check console for details', 'warning');
                }
            } catch (error) {
                log(`‚ùå Error validating tokens: ${error.message}`, 'error');
            }
        }
        
        async function forceLoadTokens() {
            log('üéØ Force loading all player tokens...', 'info');
            
            try {
                window.forceLoadPlayerTokens();
                log('üîÑ Token loading initiated - check console for progress', 'info');
                
                // Check results after a delay
                setTimeout(() => {
                    log('üîç Checking results...', 'info');
                    validateTokens();
                }, 3000);
            } catch (error) {
                log(`‚ùå Error force loading tokens: ${error.message}`, 'error');
            }
        }
        
        async function autoFixTokens() {
            log('üîß Running automatic token fix...', 'info');
            
            try {
                await window.autoFixTokens();
                log('‚úÖ Auto-fix completed - check console for details', 'success');
            } catch (error) {
                log(`‚ùå Error in auto-fix: ${error.message}`, 'error');
            }
        }
        
        function startMonitoring() {
            log('üìä Starting real-time token monitoring...', 'info');
            
            try {
                window.startTokenMonitoring();
                log('‚úÖ Monitoring started - will check tokens every 10 seconds', 'success');
            } catch (error) {
                log(`‚ùå Error starting monitoring: ${error.message}`, 'error');
            }
        }
        
        function stopMonitoring() {
            log('üìä Stopping token monitoring...', 'warning');
            
            try {
                window.stopTokenMonitoring();
                log('‚úÖ Monitoring stopped', 'success');
            } catch (error) {
                log(`‚ùå Error stopping monitoring: ${error.message}`, 'error');
            }
        }
        
        // Intercept console messages to show in our log
        const originalConsoleLog = console.log;
        const originalConsoleWarn = console.warn;
        const originalConsoleError = console.error;
        
        console.log = function(...args) {
            originalConsoleLog.apply(console, args);
            if (args[0] && typeof args[0] === 'string' && args[0].includes('Token')) {
                log(args.join(' '), 'info');
            }
        };
        
        console.warn = function(...args) {
            originalConsoleWarn.apply(console, args);
            if (args[0] && typeof args[0] === 'string' && args[0].includes('Token')) {
                log(args.join(' '), 'warning');
            }
        };
        
        console.error = function(...args) {
            originalConsoleError.apply(console, args);
            if (args[0] && typeof args[0] === 'string' && args[0].includes('Token')) {
                log(args.join(' '), 'error');
            }
        };
        
        // Auto-run validation on page load
        setTimeout(() => {
            log('üöÄ Running initial validation...', 'info');
            validateTokens();
        }, 2000);
    </script>
</body>
</html>
